# Re-ranking è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ

**å®Ÿæ–½æ—¥**: 2025-12-30
**è©•ä¾¡æ–¹æ³•**: LLMãƒ™ãƒ¼ã‚¹Re-rankingï¼ˆOpenAI gpt-4o-miniï¼‰
**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ•°**: 2ä»¶

---

## ğŸ“Š è©•ä¾¡ã‚µãƒãƒªãƒ¼

| é …ç›® | å€¤ |
|------|-----|
| **Re-rankingæ‰‹æ³•** | LLMãƒ™ãƒ¼ã‚¹ï¼ˆgpt-4o-miniï¼‰ |
| **è©•ä¾¡å¯¾è±¡** | Re-rankingåŠ¹æœæ¸¬å®šç”¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ |
| **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã®å¹³å‡ã‚¹ã‚³ã‚¢** | 0.900 |
| **Re-rankingå¾Œã®å¹³å‡ã‚¹ã‚³ã‚¢** | 0.075 |
| **é †ä½å¤‰å‹•ã‚ã‚Š** | 1/2ä»¶ (50%) |

---

## ğŸ” è©³ç´°åˆ†æ

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ #1: ãƒ­ã‚°ã‚¤ãƒ³å•é¡Œå¯¾å‡¦

**è³ªå•**: "ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„å ´åˆã®å¯¾å‡¦æ³•ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚"

#### Re-rankingå‰ï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã®ã¿ï¼‰
| é †ä½ | è¦‹å‡ºã— | ã‚¹ã‚³ã‚¢ | ãƒ•ã‚¡ã‚¤ãƒ« |
|------|--------|--------|----------|
| 1 | ãƒ‡ãƒ¼ã‚¿å¾©æ—§æ‰‹é † | 1.000 | data/sample_manual.md |
| 2 | ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã®æ¤œçŸ¥ | 0.900 | data/incident_response.md |
| 3 | æ–¹æ³•1: ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®åˆ©ç”¨ | 0.800 | data/README.md |

#### Re-rankingå¾Œï¼ˆLLMãƒ™ãƒ¼ã‚¹ï¼‰
| é †ä½ | è¦‹å‡ºã— | Re-rankã‚¹ã‚³ã‚¢ | å…ƒã‚¹ã‚³ã‚¢ | ãƒ•ã‚¡ã‚¤ãƒ« |
|------|--------|---------------|----------|----------|
| 1 | ãƒ‡ãƒ¼ã‚¿å¾©æ—§æ‰‹é † | **0.000** â†“ | 1.000 | data/sample_manual.md |
| 2 | ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã®æ¤œçŸ¥ | **0.000** â†“ | 0.900 | data/incident_response.md |
| 3 | æ–¹æ³•1: ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®åˆ©ç”¨ | **0.000** â†“ | 0.800 | data/README.md |

#### åˆ†æ
âœ… **æ­£å¸¸ãªå‹•ä½œ**: Re-rankingãŒã™ã¹ã¦ã®çµæœã‚’é–¢é€£æ€§ãªã—ï¼ˆã‚¹ã‚³ã‚¢0.0ï¼‰ã¨æ­£ã—ãåˆ¤å®š
- ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã§ã¯ã€Œãƒ­ã‚°ã‚¤ãƒ³ã€ã«é–¢ã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒã§èª¤æ¤œå‡ºã•ã‚ŒãŸå¯èƒ½æ€§
- LLMã«ã‚ˆã‚‹æ„å‘³ç†è§£ã«ã‚ˆã‚Šã€å®Ÿéš›ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³å•é¡Œã«é–¢ã™ã‚‹æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„ã¨åˆ¤å®š
- **å½é™½æ€§ï¼ˆFalse Positiveï¼‰ã®å‰Šæ¸›ã«æˆåŠŸ**

âš ï¸ **èª²é¡Œ**: ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«ã€Œãƒ­ã‚°ã‚¤ãƒ³å•é¡Œå¯¾å‡¦ã€ã«é–¢ã™ã‚‹é©åˆ‡ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒå­˜åœ¨ã—ãªã„å¯èƒ½æ€§

---

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ #2: ã‚·ã‚¹ãƒ†ãƒ åœæ­¢çŠ¶æ³ç¢ºèª

**è³ªå•**: "ã‚·ã‚¹ãƒ†ãƒ ã®åœæ­¢çŠ¶æ³ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚"

#### Re-rankingå‰ï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã®ã¿ï¼‰
| é †ä½ | è¦‹å‡ºã— | ã‚¹ã‚³ã‚¢ | ãƒ•ã‚¡ã‚¤ãƒ« |
|------|--------|--------|----------|
| 1 | ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã®æ¤œçŸ¥ | 1.000 | data/incident_response.md |
| 2 | ãƒ‡ãƒ¼ã‚¿å¾©æ—§æ‰‹é † | 0.900 | data/sample_manual.md |
| 3 | æ–¹æ³•1: ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®åˆ©ç”¨ | 0.800 | data/README.md |

#### Re-rankingå¾Œï¼ˆLLMãƒ™ãƒ¼ã‚¹ï¼‰
| é †ä½ | è¦‹å‡ºã— | Re-rankã‚¹ã‚³ã‚¢ | å…ƒã‚¹ã‚³ã‚¢ | ãƒ•ã‚¡ã‚¤ãƒ« |
|------|--------|---------------|----------|----------|
| 1 | ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã®æ¤œçŸ¥ | **0.200** â†“ | 1.000 | data/incident_response.md |
| 2 | ãƒ‡ãƒ¼ã‚¿æ¼æ´©å¯¾å¿œ | **0.150** â†‘ | 0.100 | data/incident_response.md |
| 3 | ãƒ‡ãƒ¼ã‚¿å¾©æ—§æ‰‹é † | **0.100** â†“ | 0.900 | data/sample_manual.md |

#### åˆ†æ
âœ… **é †ä½å¤‰å‹•ã‚’æ¤œå‡º**: ã€Œãƒ‡ãƒ¼ã‚¿æ¼æ´©å¯¾å¿œã€ãŒ3ä½åœå¤–ï¼ˆå…ƒã‚¹ã‚³ã‚¢0.1ï¼‰ã‹ã‚‰2ä½ã«æµ®ä¸Š
- Re-rankingã«ã‚ˆã‚Šã€å…ƒã®æ¤œç´¢ã§ã¯ä½è©•ä¾¡ã ã£ãŸçµæœãŒæ„å‘³çš„é–¢é€£æ€§ã«ã‚ˆã‚Šå†è©•ä¾¡
- ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã®é™ç•Œï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åé‡ï¼‰ã‚’è£œå®Œ

âš ï¸ **ä½ã‚¹ã‚³ã‚¢ã®å‚¾å‘**: æœ€é«˜Re-rankã‚¹ã‚³ã‚¢ã§ã‚‚0.2ã¨ä½ã„
- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«ã€Œã‚·ã‚¹ãƒ†ãƒ åœæ­¢ç¢ºèªã€ã«ç›´æ¥é–¢é€£ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒå°‘ãªã„å¯èƒ½æ€§
- ã¾ãŸã¯è³ªå•ã®è¡¨ç¾ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¡¨ç¾ã«ã‚®ãƒ£ãƒƒãƒ—ãŒã‚ã‚‹

---

## ğŸ¯ Re-ranking ã®åŠ¹æœ

### âœ… ãƒã‚¸ãƒ†ã‚£ãƒ–ãªåŠ¹æœ

1. **å½é™½æ€§ã®å‰Šæ¸›**
   - ã‚±ãƒ¼ã‚¹#1: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒã«ã‚ˆã‚‹èª¤æ¤œå‡ºã‚’æ­£ã—ã0ç‚¹è©•ä¾¡
   - ç„¡é–¢ä¿‚ãªçµæœã‚’é©åˆ‡ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

2. **æ„å‘³çš„é–¢é€£æ€§ã®è©•ä¾¡**
   - ã‚±ãƒ¼ã‚¹#2: å…ƒã‚¹ã‚³ã‚¢ãŒä½ã‹ã£ãŸçµæœã‚’æ„å‘³çš„é–¢é€£æ€§ã§å†è©•ä¾¡
   - é †ä½å¤‰å‹•ã«ã‚ˆã‚Šã€ã‚ˆã‚Šé–¢é€£æ€§ã®é«˜ã„çµæœã‚’ä¸Šä½ã«é…ç½®

3. **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ã®è£œå®Œ**
   - ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒã ã‘ã§ã¯æ‰ãˆã‚‰ã‚Œãªã„æ„å‘³çš„é–¢é€£æ€§ã‚’è©•ä¾¡
   - BM25 + Vectoræ¤œç´¢ã®å¼±ç‚¹ã‚’è£œå®Œ

### âš ï¸ èª²é¡Œã¨æ”¹å–„ç‚¹

1. **ä½ã‚¹ã‚³ã‚¢ã®å‚¾å‘**
   - Re-rankã‚¹ã‚³ã‚¢ãŒå…¨ä½“çš„ã«ä½ã„ï¼ˆ0.0ã€œ0.2ç¯„å›²ï¼‰
   - **åŸå› ä»®èª¬**:
     - ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã«è³ªå•ã¨ç›´æ¥é–¢é€£ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒä¸è¶³
     - LLMãƒ™ãƒ¼ã‚¹Re-rankingã®ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°åŸºæº–ãŒå³æ ¼
     - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ”¹å–„ä½™åœ°ã‚ã‚Š

2. **ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®èª²é¡Œ**
   - ã€Œãƒ­ã‚°ã‚¤ãƒ³å•é¡Œã€ã€Œã‚·ã‚¹ãƒ†ãƒ åœæ­¢ç¢ºèªã€ã«é–¢ã™ã‚‹å…·ä½“çš„ãªæ‰‹é †ãŒä¸è¶³
   - **æ¨å¥¨**: ã‚ˆã‚ŠåŒ…æ‹¬çš„ãªé‹ç”¨æ‰‹é †æ›¸ã‚’ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ 

3. **è©•ä¾¡ã‚±ãƒ¼ã‚¹ã®è¿½åŠ **
   - ç¾åœ¨2ä»¶ã®ã¿ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
   - **æ¨å¥¨**: ã‚ˆã‚Šå¤šæ§˜ãªã‚·ãƒŠãƒªã‚ªã§è©•ä¾¡ï¼ˆ10ä»¶ä»¥ä¸Šï¼‰

---

## ğŸ“ˆ æ¨å¥¨äº‹é …

### é«˜å„ªå…ˆåº¦

1. **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æ‹¡å……**
   ```bash
   # ä»¥ä¸‹ã®ãƒˆãƒ”ãƒƒã‚¯ã‚’å«ã‚€æ‰‹é †æ›¸ã‚’è¿½åŠ æ¨å¥¨
   - ãƒ­ã‚°ã‚¤ãƒ³ãƒ»èªè¨¼ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
   - ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æ‰‹é †
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨ºæ–­æ‰‹é †
   - ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ç®¡ç†
   ```

2. **è©•ä¾¡ã‚±ãƒ¼ã‚¹ã®è¿½åŠ **
   - Re-rankingåŠ¹æœæ¸¬å®šç”¨ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’10ä»¶ä»¥ä¸Šã«æ‹¡å¤§
   - å¤šæ§˜ãªã‚·ãƒŠãƒªã‚ªï¼ˆç·Šæ€¥å¯¾å¿œã€å®šå¸¸ç›£è¦–ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç­‰ï¼‰

3. **Cohere Rerank APIã®æ¯”è¼ƒ**
   - COHERE_API_KEYã‚’å–å¾—ã—ã¦Cohere Rerankã¨ã®æ¯”è¼ƒè©•ä¾¡
   - LLMãƒ™ãƒ¼ã‚¹ã¨Cohereãƒ™ãƒ¼ã‚¹ã®ç²¾åº¦ãƒ»é€Ÿåº¦ãƒ»ã‚³ã‚¹ãƒˆæ¯”è¼ƒ

### ä¸­å„ªå…ˆåº¦

4. **Re-rankingãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°**
   - `RERANK_TOP_K_BEFORE`ã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆç¾åœ¨10ä»¶ï¼‰
   - æœ€é©å€¤ã®æ¢ç´¢ï¼ˆ5, 15, 20ä»¶ã§æ¯”è¼ƒï¼‰

5. **LLMãƒ™ãƒ¼ã‚¹Re-rankingã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ”¹å–„**
   - ç¾åœ¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’åˆ†æã—ã€ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°åŸºæº–ã‚’æ˜ç¢ºåŒ–
   - ã‚ˆã‚Šç²¾åº¦ã®é«˜ã„é–¢é€£æ€§è©•ä¾¡ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ¤œè¨

6. **LLM as a Judgeè©•ä¾¡ã®å®Ÿæ–½**
   - Streamlit UIã®ã€Œè©•ä¾¡å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‹ã‚‰ç·åˆè©•ä¾¡ã‚’å®Ÿæ–½
   - æ ¹æ‹ æ€§ã€æ­£ç¢ºæ€§ã€ç¶²ç¾…æ€§ã€å®‰å…¨æ€§ã®6é …ç›®ã§å®šé‡è©•ä¾¡

### ä½å„ªå…ˆåº¦

7. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š**
   - Re-rankingæœ‰åŠ¹æ™‚ã®å‡¦ç†æ™‚é–“æ¸¬å®š
   - ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®æ¤œè¨

---

## ğŸ§ª æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **å³å®Ÿæ–½å¯èƒ½**
   ```bash
   # ãƒ‡ãƒ¼ã‚¿è¿½åŠ 
   # data/ãƒ•ã‚©ãƒ«ãƒ€ã«é‹ç”¨æ‰‹é †æ›¸ã‚’è¿½åŠ 

   # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å†æ§‹ç¯‰
   streamlit run main.py
   # â†’ ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ã€Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å†æ§‹ç¯‰ã€

   # å†è©•ä¾¡
   python eval/compare_reranking.py
   ```

2. **Cohere Rerank APIè©•ä¾¡**
   ```bash
   # .envã«APIã‚­ãƒ¼è¿½åŠ 
   echo "COHERE_API_KEY=your_key" >> .env

   # è©•ä¾¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä¿®æ­£ã—ã¦Cohereä½¿ç”¨
   # eval/compare_reranking.py ã® method="llm" ã‚’ method="cohere" ã«å¤‰æ›´

   # å†è©•ä¾¡
   python eval/compare_reranking.py
   ```

3. **ç·åˆè©•ä¾¡å®Ÿæ–½**
   - Streamlit UIã‹ã‚‰ã€Œè©•ä¾¡å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   - Re-rankingæœ‰åŠ¹/ç„¡åŠ¹ã®è¨­å®šã‚’åˆ‡ã‚Šæ›¿ãˆã¦2å›å®Ÿæ–½
   - çµæœã‚’æ¯”è¼ƒåˆ†æ

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [SHORT_TERM_EXTENSIONS.md](./SHORT_TERM_EXTENSIONS.md): Re-rankingè¨­è¨ˆæ›¸
- [RERANKING_IMPLEMENTATION.md](./RERANKING_IMPLEMENTATION.md): Re-rankingå®Ÿè£…ãƒ¬ãƒãƒ¼ãƒˆ
- [IMPLEMENTATION_COMPLETE.md](./IMPLEMENTATION_COMPLETE.md): å…¨ä½“å®Ÿè£…å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ
- [eval/rerank_comparison_data.json](./eval/rerank_comparison_data.json): è©•ä¾¡çµæœè©³ç´°ï¼ˆJSONï¼‰

---

**è©•ä¾¡å®Ÿæ–½è€…**: Claude Sonnet 4.5
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**æœ€çµ‚æ›´æ–°**: 2025-12-30
